function onLoadProductForecasting(){setResponsivePlots();setUpProductDescriptionTypeahead()}function setResponsivePlots(n=".responsive-plot"){var i=Plotly.d3,r=i.selectAll(n),t=r[0];window.onresize=function(){for(var n=0;n<t.length;n++)t[n].attributes.width&&Plotly.Plots.resize(t[n])}}function setUpProductDescriptionTypeahead(n="#remote .typeahead"){var t=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:`${apiUri.catalog}/productSetDetailsByDescription?description=%QUERY`,wildcard:"%QUERY"}});$(n).typeahead({minLength:3,highlight:!0},{name:"products",display:"description",limit:10,source:t}).on("typeahead:selected",function(n,t){$("#productName").text(t.description);$("#productPrice").text(t.price);$("#productImage").attr("src",t.pictureUri).attr("alt",t.description);console.log(t.id);getProductData(t)})}function getProductData(n){productId=n.id;description=n.description;getHistory(productId).done(function(t){t.length<4||$.when(getForecast(t[t.length-2],n),getForecast(t[t.length-1],n)).done(function(n,i){n[1]=="success"&&i[1]=="success"&&plotLineChart(n[0],i[0],t,description)})})}function getForecast(n,t){var i=`?month=${n.month}&year=${n.year}&avg=${n.avg}&max=${n.max}&min=${n.min}&count=${n.count}&prev=${n.prev}&units=${n.units}`,r=`&price=${t.price}&color=${t.color||""}&size=${t.size||""}&shape=${t.shape||""}&agram=${t.agram||""}&bgram=${t.bgram||""}&ygram=${t.ygram||""}&zgram=${t.zgram||""}`;return $.getJSON(`${apiUri.forecasting}/product/${n.productId}/forecast${i}${r}`)}function getHistory(n){return $.getJSON(`${apiUri.ordering}/product/${n}/history`)}function getStats(n){return $.getJSON(`${apiUri.ordering}/product/${n}/stats`)}function plotLineChart(n,t,i,r){var u=TraceHistory(i),f=TraceForecast(u.x,nextMonth(i[i.length-1]),u.y,n,t),e=TraceMean(u.x.concat(f.x),u.y),o={title:r+" - sales forecasting"};Plotly.newPlot("lineChart",[u,f,e],o)}function TraceHistory(n){var t=$.map(n,function(n){return n.units}),i=$.map(n,function(n){return`${months[n.month]}/${n.year}`});return{x:i,y:t,mode:"lines+markers",name:"history",line:{shape:"spline"}}}function TraceForecast(n,t,i,r,u){return{x:[n[n.length-2],n[n.length-1],t],y:[i[i.length-2],r,u],mode:"lines+markers",name:"forecasting",line:{shape:"spline"}}}function TraceMean(n,t){var i=t.reduce((n,t)=>t+=n)/t.length;return{x:n,y:Array(n.length).fill(i),name:"average",mode:"lines"}}function nextMonth(n){return n.month==12?`${months[1]}/${n.year+1}`:`${months[n.month+1]}/${n.year}`}function onLoadCountryForecasting(){setResponsivePlots()}function getCountryData(n){$.getJSON(`${apiUri.ordering}/country/${n}/history`).done(function(t){t.length<4||$.when(getCountryForecast(t[t.length-2]),getCountryForecast(t[t.length-1])).done(function(i,r){i[1]=="success"&&r[1]=="success"&&plotLineChartCountry(i[0],r[0],t,n)})})}function getCountryForecast(n){var t=`?month=${n.month}&year=${n.year}&avg=${n.avg}&max=${n.max}&min=${n.min}&prev=${n.prev}&count=${n.count}&units=${n.units}`;return $.getJSON(`${apiUri.forecasting}/country/${n.country}/forecast${t}`)}function plotLineChartCountry(n,t,i,r){var u=getTraceCountryHistory(i),f=getTraceCountryForecast(u.x,nextMonth(i[i.length-1]),u.y,n,t),e=TraceMean(u.x.concat(f.x),u.y),o={title:r+" - sales forecasting"};Plotly.newPlot("lineChart",[u,f,e],o)}function getTraceCountryHistory(n){var t=$.map(n,function(n){return n.units}),i=$.map(n,function(n){return`${months[n.month]}/${n.year}`});return{x:i,y:t,mode:"lines+markers",name:"history",line:{shape:"spline"}}}function getTraceCountryForecast(n,t,i,r,u){return{x:[n[n.length-2],n[n.length-1],t],y:[i[i.length-2],r,u],mode:"lines+markers",name:"forecasting",line:{shape:"spline"}}}var months=["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];